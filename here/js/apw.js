if (typeof _apw !== 'undefined') {(function(b,a,c){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(g,f){if(f===null){f=0}else{if(f<0){f=Math.max(0,this.length+f)}}for(var e=f,d=this.length;e<d;e++){if(this[e]===g){return e}}return -1}}_apw.modules.std={update:function(){},reset:function(){var d=a.createElement("img");d.src="//"+_apw.settings.base_domain+"/apw/api/v1/reset.gif";a.body.appendChild(d)},get_cookie:function(e){var d=a.cookie.split(/;\s*/);e+="=";for(var f=d.length-1;f>=0;f--){if(!d[f].indexOf(e)){return d[f].replace(e,"")}}return null},get_cookies:function(g){var d={};var e=a.cookie.split(/;\s*/);for(var f=e.length-1;f>=0;f--){var h=/^([^=]*)=(.*)$/.exec(e[f]);if(h){if(g.test(h[1])){d[h[1]]=h[2]}}}return d},set_cookie:function(e,f,d){a.cookie=e+"="+f+"; domain=."+_apw.settings.cookie_domain+"; path=/; expires="+new Date(d*1000).toGMTString()},delete_cookie:function(d){_apw.modules.std.set_cookie(d,"",0)}}})(window,document);(function(c,a,e){var d={meters:{},interval:null};function b(f,h){var g=/^(\d+)\.\d+\.(\d+)\..*\..+$/.exec(h);if(g!==null){try{return{name:f,value:h,expiration:parseInt(g[1],10),used_quota:parseInt(g[2],10)}}catch(i){return null}}else{return null}}_apw.modules.meters={update:function(){var p=/^apw_(exc|aac)_[a-zA-Z0-9\-_]+$/;var m={};var f,h,n,j,k;var o=_apw.modules.std.get_cookies(p);for(f in o){if(o.hasOwnProperty(f)){h=b(f,o[f]);if(h!==null){m[h.name]=h}else{_apw.modules.std.delete_cookie(h.name)}}}var g=[];try{for(k=0;k<localStorage.length;k++){f=localStorage.key(k);if(p.test(f)){if(!m.hasOwnProperty(f)){h=b(f,localStorage[f]);if(h!==null){m[h.name]=h;g.push(h)}else{localStorage.removeItem(f)}}}}}catch(l){}n=c.name.split(";");if(n.shift()==_apw.settings.cookie_domain){for(k=n.length-1;k>=0;k--){j=/^([^=]*)=(.*)$/.exec(n[k]);if(j){if(p.test(j[1])){if(!m.hasOwnProperty(j[1])){h=b(j[1],j[2]);if(h!==null){m[h.name]=h;g.push(h)}}}}}}for(k=0;k<g.length;k++){h=g[k];_apw.modules.std.set_cookie(h.name,h.value,h.expiration)}n=[];for(f in m){if(m.hasOwnProperty(f)){h=m[f];try{localStorage[h.name]=h.value}catch(l){}n.push(h.name+"="+h.value)}}if(n.length>0){n.unshift(_apw.settings.cookie_domain);c.name=n.join(";")}for(f in m){if(m.hasOwnProperty(f)){h=m[f];d.meters[h.name]={expiration:h.expiration,used_quota:h.used_quota}}}if(d.interval){clearInterval(d.interval)}d.interval=setInterval(_apw.modules.meters.update,2000)},get:function(i,k){var f=null;var h="apw_"+i+"_"+k;if(d.meters.hasOwnProperty(h)){var j=d.meters[h];var g=Math.round(new Date().getTime()/1000);if(g<j.expiration){f={expiration:j.expiration,used_quota:j.used_quota}}}return f}}})(window,document);(function(b,a,c){_apw.modules.anonymous_ac={update:function(){},get:function(e){var f=_apw.settings.anonymous_ac.fallback;if(e in _apw.settings.anonymous_ac.pids){f=_apw.settings.anonymous_ac.pids[e]}var d={pid:e,quota:f.quota,used:0,available:f.quota,expiration:Math.max(f.period.end-Math.round(new Date().getTime()/1000),0)};var g=_apw.modules.meters.get("aac",e);if(g!==null){d.used=g.used_quota;d.available=d.quota-d.used;d.expiration=Math.max(g.expiration-Math.round(new Date().getTime()/1000),0)}return d}}})(window,document);(function(c,a,e){var d={name:"apw_subs"};var b=function(f){this.get=function(){return f};this.subscribed=function(g){var h=parseInt(Date.now()/1000);for(var j in f.allowed){if(f.allowed.hasOwnProperty(j)){var i=f.allowed[j];if((i.exp>h)&&(i.pids.indexOf(g)>=0)){return true}}}return false};this.serialize=function(){try{return JSON.stringify(f)}catch(g){return null}}};b.deserialize=function(g){try{return new b(JSON.parse(g))}catch(f){return null}};_apw.modules.subscribers_ac={update:function(){},reset:function(){_apw.modules.std.reset()},load:function(m,g){var f=null;if(!g){var h=_apw.modules.std.get_cookie(d.name);if(h!==null){var i=/^(\d+)\.(.+)$/.exec(h);if(i!==null){try{var k=parseInt(i[1],10);if(k>Date.now()-_apw.settings.subscribers_ac.cookie_subs_ttl*1000){f=b.deserialize(decodeURIComponent(i[2]))}}catch(j){}}}}if(f!==null){m(f)}else{var n="__apw_sac"+Math.floor(Math.random()*1000000);c[n]=function(o){delete c[n];var q=new b(o);var p=q.serialize();if((p!==null)&&(p.length<=_apw.settings.subscribers_ac.max_cookie_size)){_apw.modules.std.set_cookie(d.name,Date.now()+"."+encodeURIComponent(p))}else{_apw.modules.std.delete_cookie(d.name)}m(q)};var l=a.createElement("script");l.type="text/javascript";l.src="//"+_apw.settings.base_domain+"/apw/api/v1/subscriptions/?callback="+n;a.head.appendChild(l)}}}})(window,document);(function(b,a,d){var c=["std","meters","anonymous_ac","subscribers_ac"];_apw.update=function(){try{for(var f=0;f<c.length;f++){if(c[f] in _apw.modules){_apw.modules[c[f]].update()}}_apw.reset=function(){_apw.modules.std.reset()}}catch(g){if(console!==d&&console!==null){console.log("Failed to set APW state: "+g)}}};_apw.update()})(window,document);}